# Simple Elastic Stack Deployment

A complete, Proof of Concept, Single-Node Elastic Stack deployment with Elasticsearch, Kibana, and Fleet Server running in Docker containers. Features automated setup, SSL/TLS encryption, and comprehensive management tooling.

## Note: This deployment is intended for development, testing, and learning purposes. It is not recommended for production use without further hardening and configuration adjustments

## üöÄ Features

- **üîê Secure by Default**: Full SSL/TLS encryption with auto-generated certificates
- **‚ö° One-Command Setup**: Fully automated installation and configuration
- **üîÑ Fleet Server Ready**: Pre-configured Fleet Server for centralized agent management
- **üìä Complete Monitoring**: Elasticsearch, Kibana, and Fleet Server with health checks
- **üõ†Ô∏è Management Script**: Comprehensive CLI tool for lifecycle management
- **üì¶ Docker Compose Based**: Easy deployment with profile-based service management
- **üîë Auto Token Management**: Automatic Fleet service token generation and configuration
- **üìù Persistent Logging**: Centralized logging for all services

## üìã Table of Contents

- [Prerequisites](#-prerequisites)
- [Quick Start](#-quick-start)
- [Configuration](#Ô∏è-configuration)
- [Management Commands](#-management-commands)
- [Architecture](#Ô∏è-architecture)
- [Volumes and Data](#-volumes-and-data)
- [Security](#-security)
- [Troubleshooting](#-troubleshooting)
- [Advanced Usage](#-advanced-usage)

## ‚úÖ Prerequisites

- **Docker**: Version 20.10 or higher
- **Docker Compose**: V2 (comes with Docker Desktop)
- **OpenSSL**: For encryption key generation
- **System Resources**:
  - Minimum: 8GB RAM, 4 CPU cores
  - Recommended: 16GB RAM, 8 CPU cores
- **Disk Space**: At least 10GB free for data and logs
- **Operating System**: Linux, macOS, or Windows with WSL2

### Install Prerequisites (Linux)

```bash
# Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Add user to docker group
sudo usermod -aG docker $USER

# OpenSSL (usually pre-installed)
sudo apt-get install openssl  # Debian/Ubuntu
sudo yum install openssl      # RHEL/CentOS
```

## üöÄ Quick Start

### 1. Clone and Navigate

```bash
git clone https://github.com/ProxayFox/SimpleElasticStack.git; cd SimpleElasticStack
```

### 2. Configure Environment

```bash
# Copy example environment file
cp .env.example .env

# Edit configuration (IMPORTANT: Change passwords!)
nano .env
```

**Required Configuration:**

```bash
# Strong passwords (minimum 6 characters)
ELASTIC_PASSWORD=your_super_secret_password_here
KIBANA_PASSWORD=another_strong_password_here

# Your host machine IP address
HOST_IP=192.168.1.100

# Elastic Stack version
STACK_VERSION=9.2.0
STACK_IMAGE=-wolfi

# Resource limits
MEM_LIMIT=4g
```

### 3. Fresh Installation

```bash
# Interactive mode (with confirmation)
./elastic-stack.sh --new

# Automated mode (no prompts)
./elastic-stack.sh --new --force
```

This will:

- ‚úÖ Generate SSL/TLS certificates
- ‚úÖ Initialize Elasticsearch cluster
- ‚úÖ Configure Kibana with encryption keys
- ‚úÖ Set up Fleet Server with service token
- ‚úÖ Start all services with health checks

### 4. Access Services

| Service | URL | Credentials |
|---------|-----|-------------|
| **Kibana** | <http://localhost:5601> | elastic / `${ELASTIC_PASSWORD}` |
| **Elasticsearch** | <https://localhost:9200> | elastic / `${ELASTIC_PASSWORD}` |
| **Fleet Server** | <https://localhost:8220> | (Internal - managed by Kibana) |

## ‚öôÔ∏è Configuration

### Environment Variables

#### Required Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `ELASTIC_PASSWORD` | Password for 'elastic' superuser | `MySecurePass123!` |
| `KIBANA_PASSWORD` | Password for 'kibana_system' user | `AnotherPass456!` |
| `HOST_IP` | IP address of host machine | `192.168.1.100` |

#### Optional Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `STACK_VERSION` | Elastic Stack version | `9.2.0` |
| `STACK_IMAGE` | Image variant (-wolfi, -ubi9) | `-wolfi` |
| `LICENSE` | License type (basic, trial) | `basic` |
| `CLUSTER_NAME` | Elasticsearch cluster name | `simple_elk` |
| `MEM_LIMIT` | Elasticsearch memory limit | `4g` |
| `COMPOSE_PROJECT_NAME` | Docker Compose project name | `simple_elk` |

#### Auto-Generated Variables

These are automatically generated by `elastic-stack.sh`:

- `ENCRYPTION_KEY` - Kibana encrypted saved objects
- `REPORTING_ENCRYPTION_KEY` - Kibana reporting encryption
- `SECURITY_ENCRYPTION_KEY` - Kibana security encryption
- `FLEET_SERVER_SERVICE_TOKEN` - Fleet Server authentication token

### Kibana Configuration

Located in `configs/kibana.yml`:

```yaml
server.name: kibana
server.host: "0.0.0.0"
elasticsearch.hosts: ["https://elasticsearch:9200"]
monitoring.ui.container.elasticsearch.enabled: true

logging:
  appenders:
    default:
      type: console
    file:
      type: file
      fileName: /logs/kibana/kibana.log
  root:
    appenders: [default, file]
```

## üéÆ Management Commands

You can also manage the stack using docker compose commands directly, but the script simplifies common tasks.

### Lifecycle Operations

```bash
# Start the stack
./elastic-stack.sh --start

# Stop the stack
./elastic-stack.sh --stop

# Restart the stack
./elastic-stack.sh --restart

# Check status with health information
./elastic-stack.sh --status
```

### Fresh Installation

```bash
# With confirmation prompt
./elastic-stack.sh --new

# Skip confirmation (for automation)
./elastic-stack.sh --new --force
```

**Warning**: `--new` will delete ALL existing data including:

- Elasticsearch indices and data (`esdata/`)
- SSL/TLS certificates (`certs/`)
- Logs (`logs/`)
- Docker volumes

### Viewing Logs

```bash
# All services
./elastic-stack.sh --logs

# Follow logs in real-time
./elastic-stack.sh --logs --follow

# Specific service
./elastic-stack.sh --logs --service elasticsearch
./elastic-stack.sh --logs --service kibana
./elastic-stack.sh --logs --service fleet-server
```

### Cleanup

```bash
# With confirmation
./elastic-stack.sh --clean

# Skip confirmation
./elastic-stack.sh --clean --force
```

### Help

```bash
./elastic-stack.sh --help
```

## üèóÔ∏è Architecture

### Service Overview

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Docker Network: elastic              ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇElasticsearch‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  Kibana  ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§Fleet Server‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   :9200     ‚îÇ      ‚îÇ  :5601   ‚îÇ      ‚îÇ   :8220    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   :9300     ‚îÇ      ‚îÇ          ‚îÇ      ‚îÇ            ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ         ‚îÇ                  ‚îÇ                  ‚îÇ         ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îÇ                      Shared Volumes:                    ‚îÇ
‚îÇ                 - certs/ (SSL/TLS)                      ‚îÇ
‚îÇ                 - logs/ (Application logs)              ‚îÇ
‚îÇ                 - esdata/ (Elasticsearch data)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Services

#### 1. Setup (Profile: `setup`)

**Container**: `elasticsearch-setup`

- **Purpose**: One-time certificate generation and user configuration
- **Lifecycle**: Runs once then exits
- **Responsibilities**:
  - Generate Certificate Authority (CA)
  - Create SSL/TLS certificates for all services
  - Set `kibana_system` user password
  - Configure DNS and IP SANs for certificates

#### 2. Elasticsearch

**Container**: `elasticsearch`

- **Image**: `docker.elastic.co/elasticsearch/elasticsearch-wolfi:9.2.0`
- **Ports**: 9200 (HTTPS), 9300 (Transport)
- **Mode**: Single-node cluster
- **Features**:
  - Full SSL/TLS encryption
  - X-Pack security enabled
  - Machine learning enabled
  - Monitoring collection enabled

#### 3. Kibana

**Container**: `kibana`

- **Image**: `docker.elastic.co/kibana/kibana-wolfi:9.2.0`
- **Port**: 5601 (HTTP)
- **Features**:
  - Fleet management UI
  - Monitoring dashboards
  - Encrypted saved objects
  - Console logging + file logging

#### 4. Fleet Setup (Profile: `setup`)

**Container**: `fleet-setup`

- **Purpose**: Configure Fleet Server via Kibana API
- **Lifecycle**: Runs once then exits
- **Responsibilities**:
  - Initialize Fleet in Kibana
  - Create Fleet Server policy
  - Generate Fleet service token
  - Save configuration for Fleet Server

#### 5. Fleet Server (Profile: `fleet`)

**Container**: `fleet-server`

- **Image**: `docker.elastic.co/elastic-agent/elastic-agent-complete:9.2.0`
- **Port**: 8220 (HTTPS)
- **Purpose**: Central management for Elastic Agents
- **Features**:
  - HTTPS endpoint for agent enrollment
  - Auto-enrolls as fleet-server-policy
  - SSL/TLS secured communication

## üíæ Volumes and Data

### Volume Mappings

| Volume | Type | Path | Purpose |
|--------|------|------|---------|
| `certs` | Bind mount | `./certs` | SSL/TLS certificates |
| `esdata` | Bind mount | `./esdata` | Elasticsearch data |
| `logs` | Bind mount | `./logs` | Application logs |
| `fleet-data` | Docker volume | N/A | Fleet configuration cache |

### Directory Structure

```text
simple_elk/
‚îú‚îÄ‚îÄ certs/                     # SSL/TLS certificates (auto-generated)
‚îÇ   ‚îú‚îÄ‚îÄ ca/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ca.crt             # Certificate Authority
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ca.key
‚îÇ   ‚îú‚îÄ‚îÄ elasticsearch/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ elasticsearch.crt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ elasticsearch.key
‚îÇ   ‚îú‚îÄ‚îÄ kibana/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kibana.crt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ kibana.key
‚îÇ   ‚îî‚îÄ‚îÄ fleet-server/
‚îÇ       ‚îú‚îÄ‚îÄ fleet-server.crt
‚îÇ       ‚îî‚îÄ‚îÄ fleet-server.key
‚îú‚îÄ‚îÄ esdata/                    # Elasticsearch data
‚îÇ   ‚îú‚îÄ‚îÄ nodes/
‚îÇ   ‚îú‚îÄ‚îÄ indices/
‚îÇ   ‚îî‚îÄ‚îÄ _state/
‚îú‚îÄ‚îÄ logs/                      # Centralized logs
‚îÇ   ‚îú‚îÄ‚îÄ elasticsearch/
‚îÇ   ‚îú‚îÄ‚îÄ kibana/
‚îÇ   ‚îî‚îÄ‚îÄ elastic-agent/
‚îú‚îÄ‚îÄ configs/
‚îÇ   ‚îî‚îÄ‚îÄ kibana.yml             # Kibana configuration
‚îú‚îÄ‚îÄ .env                       # Environment variables
‚îú‚îÄ‚îÄ docker-compose.yml         # Service definitions
‚îú‚îÄ‚îÄ elastic-stack.sh           # Management script
‚îî‚îÄ‚îÄ fleet-setup.sh             # Fleet configuration script
```

### Backup Strategy

```bash
# Backup Elasticsearch data
sudo tar -czf esdata-backup-$(date +%Y%m%d).tar.gz esdata/

# Backup certificates
sudo tar -czf certs-backup-$(date +%Y%m%d).tar.gz certs/

# Backup configuration
tar -czf config-backup-$(date +%Y%m%d).tar.gz .env configs/

# Full backup
sudo tar -czf full-backup-$(date +%Y%m%d).tar.gz \
  esdata/ certs/ logs/ .env configs/ docker-compose.yml
```

### Restore

```bash
# Stop services
./elastic-stack.sh --stop

# Restore data
sudo rm -rf esdata/
sudo tar -xzf esdata-backup-YYYYMMDD.tar.gz

# Restore certificates
sudo rm -rf certs/
sudo tar -xzf certs-backup-YYYYMMDD.tar.gz

# Start services
./elastic-stack.sh --start
```

## üîí Security

### SSL/TLS Encryption

All services communicate over encrypted connections:

- **Elasticsearch HTTP**: HTTPS (port 9200)
- **Elasticsearch Transport**: TLS (port 9300)
- **Fleet Server API**: HTTPS (port 8220)
- **Kibana ‚Üí Elasticsearch**: HTTPS

### Certificate Details

Certificates are generated with:

- **Type**: PEM format
- **CA**: Self-signed Certificate Authority
- **DNS SANs**: Service names + localhost
- **IP SANs**: 127.0.0.1 + `${HOST_IP}`
- **Key Size**: 2048-bit RSA

### Authentication

| Service | User | Password Source |
|---------|------|-----------------|
| Elasticsearch | `elastic` | `.env` ‚Üí `ELASTIC_PASSWORD` |
| Kibana System | `kibana_system` | `.env` ‚Üí `KIBANA_PASSWORD` |
| Fleet Server | Service Token | Auto-generated in `.env` |

### Encryption Keys

Kibana uses three encryption keys (auto-generated):

- `ENCRYPTION_KEY` - Saved objects
- `REPORTING_ENCRYPTION_KEY` - Report encryption
- `SECURITY_ENCRYPTION_KEY` - Security features

### Best Practices

1. **Change default passwords** in `.env` before first run
2. **Use strong passwords** (minimum 12 characters recommended)
3. **Secure `.env` file**: `chmod 600 .env`
4. **Backup certificates** in `certs/` directory
5. **Keep `FLEET_SERVER_SERVICE_TOKEN` secret**
6. **Rotate passwords regularly** using Elasticsearch API
7. **Limit network access** using firewall rules

### Password Rotation

```bash
export OLD_PASSWORD="current_elastic_password"
export NEW_PASSWORD="new_secure_password"

# Change elastic password
# May need to use sudo if permissions to access certs dir
curl -X POST "https://localhost:9200/_security/user/elastic/_password" \
  -u "elastic:${OLD_PASSWORD}" \
  --cacert ./certs/ca/ca.crt \
  -H "Content-Type: application/json" \
  -d '{"password": "'"${NEW_PASSWORD}"'"}'

# Update .env file
sed -i 's/ELASTIC_PASSWORD=.*/ELASTIC_PASSWORD='"${NEW_PASSWORD}"'/' .env
```

## üêõ Troubleshooting

### Common Issues

#### 1. Setup Fails: "ELASTIC_PASSWORD not set"

**Solution**: Ensure `.env` file exists and contains valid passwords:

```bash
cp .env.example .env
nano .env  # Set ELASTIC_PASSWORD and KIBANA_PASSWORD
```

#### 2. Elasticsearch Won't Start (Memory Errors)

**Symptoms**: "max virtual memory areas vm.max_map_count [65530] is too low"

**Solution**:

```bash
# Temporary fix
sudo sysctl -w vm.max_map_count=262144

# Permanent fix
echo "vm.max_map_count=262144" | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

#### 3. Permission Denied on certs/ or esdata/

**Solution**: These directories require elevated permissions:

```bash
# The script handles this, but if needed manually:
sudo chown -R 1000:1000 esdata/
sudo chmod -R 755 esdata/
```

#### 4. Fleet Server Not Healthy

**Check logs**:

```bash
./elastic-stack.sh --logs --service fleet-server
```

**Common causes**:

- Invalid `FLEET_SERVER_SERVICE_TOKEN`
- Elasticsearch not reachable
- Certificate issues

**Solution**: Re-run setup:

```bash
./elastic-stack.sh --new --force
```

#### 5. Kibana Keeps Restarting

**Check health**:

```bash
./elastic-stack.sh --logs --service kibana
```

**Common causes**:

- Elasticsearch not ready
- Wrong `KIBANA_PASSWORD`
- Missing encryption keys

**Solution**: Verify `.env` and regenerate keys:

```bash
# Remove old keys from .env
grep -v "ENCRYPTION_KEY\|REPORTING_ENCRYPTION_KEY\|SECURITY_ENCRYPTION_KEY" .env > .env.tmp
mv .env.tmp .env

# Re-run setup (will regenerate keys)
./elastic-stack.sh --new --force
```

#### 6. Port Already in Use

**Symptoms**: "bind: address already in use"

**Check ports**:

```bash
sudo lsof -i :9200  # Elasticsearch
sudo lsof -i :5601  # Kibana
sudo lsof -i :8220  # Fleet Server
```

**Solution**: Stop conflicting services or change ports in `docker-compose.yml`

### Health Check Commands

```bash
# Check Elasticsearch
curl -k -u "elastic:${ELASTIC_PASSWORD}" \
  https://localhost:9200/_cluster/health?pretty

# Check Kibana
curl -I http://localhost:5601

# Check Fleet Server
curl -k https://localhost:8220/api/status

# Check all containers
docker compose ps

# View container logs
docker logs elasticsearch
docker logs kibana
docker logs fleet-server
```

### Debug Mode

Enable verbose logging:

```bash
# Add to .env
LOG_LEVEL=debug

# Restart services
./elastic-stack.sh --restart

# Watch logs
./elastic-stack.sh --logs --follow
```

## üîß Advanced Usage

### Custom Elasticsearch Configuration

Create `configs/elasticsearch.yml`:

```yaml
# Custom Elasticsearch settings
indices.query.bool.max_clause_count: 2048
search.max_buckets: 20000
```

Mount in `docker-compose.yml`:

```yaml
volumes:
  - ./configs/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro
```

### Multi-Node Cluster

For production, modify `docker-compose.yml` to add nodes:
You'll need to set up enrollment tokens and proper cluster settings.
You'll also need to have three nodes for a resilient cluster.

```bash
# Generate a new enrollment token and copy it
export NODE02_ENROLLMENT_TOKEN=$(docker exec -it elasticsearch /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s node)
export NODE03_ENROLLMENT_TOKEN=$(docker exec -it elasticsearch /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s node)
```

Add the token to the .env file and configure the new node:

```bash
sed -i 's/NODE02_ENROLLMENT_TOKEN=.*/NODE02_ENROLLMENT_TOKEN='"${NODE02_ENROLLMENT_TOKEN}"'/' .env
sed -i 's/NODE03_ENROLLMENT_TOKEN=.*/NODE03_ENROLLMENT_TOKEN='"${NODE03_ENROLLMENT_TOKEN}"'/' .env
```

```yaml
elasticsearch-02:
  ... # similar to elasticsearch
  environment:
    - node.name=elasticsearch-02
    - cluster.name=${CLUSTER_NAME}
    - discovery.seed_hosts=elasticsearch
    - cluster.initial_master_nodes=elasticsearch,elasticsearch-02
    - ENROLLMENT_TOKEN=${NODE02_ENROLLMENT_TOKEN}
  ... # other configurations similar to elasticsearch

elasticsearch-03:
  ... # similar to elasticsearch
  environment:
    - node.name=elasticsearch-03
    - cluster.name=${CLUSTER_NAME}
    - discovery.seed_hosts=elasticsearch
    - cluster.initial_master_nodes=elasticsearch,elasticsearch-02
    - ENROLLMENT_TOKEN=${NODE03_ENROLLMENT_TOKEN}
  ... # other configurations similar to elasticsearch
```

There's probably more to configure for a multi-node cluster, such as updating the setup service to setup the certificates for multiple nodes.
e.g. in the docker-compose.yml for the setup service, you would need to update the SANs like so:

```text
"instances:\n"\
"  - name: elasticsearch\n"\
"    dns:\n"\
"      - elasticsearch\n"\
"      - localhost\n"\
"    ip:\n"\
"      - 127.0.0.1\n"\
"      - ${HOST_IP}\n"\
"  - name: kibana\n"\
"    dns:\n"\
"      - kibana\n"\
"      - localhost\n"\
"    ip:\n"\
"      - 127.0.0.1\n"\
"      - ${HOST_IP}\n"\
"  - name: fleet-server\n"\
"    dns:\n"\
"      - fleet-server\n"\
"      - localhost\n"\
"    ip:\n"\
"      - 127.0.0.1\n"\
"      - ${HOST_IP}\n"\
"  - name: elasticsearch-02\n"\
"    dns:\n"\
"      - elasticsearch-02\n"\
"      - localhost\n"\
"    ip:\n"\
"      - 127.0.0.1\n"\
"      - ${HOST_IP}\n"\
"  - name: elasticsearch-03\n"\
"    dns:\n"\
"      - elasticsearch-03\n"\
"      - localhost\n"\
"    ip:\n"\
"      - 127.0.0.1\n"\
"      - ${HOST_IP}\n"\
```

You would need to add additional entries for `elasticsearch-02` and `elasticsearch-03` so that
each node would need its own entry.
I'll probably setup another repository for a multi-node cluster setup in the future.

### Resource Limits

Adjust in `.env`:

```bash
MEM_LIMIT=8g  # For 8GB RAM systems
```

Or set specific limits in `docker-compose.yml`:

```yaml
deploy:
  resources:
    limits:
      cpus: '2.0'
      memory: 8G
    reservations:
      memory: 4G
```

### Integration with External Systems

#### Send Logs via Elastic Agent

There's better instructions in the kibana GUI, but also see [Fleet Setup Guide](FLEET_SETUP.md)

```bash
# Enroll agent in Kibana
# Fleet ‚Üí Add agent ‚Üí Copy enrollment command
sudo elastic-agent enroll \
  --url=https://192.168.1.100:8220 \
  --enrollment-token=YOUR_TOKEN \
  --certificate-authorities=/path/to/ca.crt
```

#### API Access

```bash
# Index a document
curl -X POST "https://localhost:9200/my-index/_doc" \
  -u "elastic:${ELASTIC_PASSWORD}" \
  --cacert ./certs/ca/ca.crt \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello Elasticsearch"}'

# Search documents
curl -X GET "https://localhost:9200/my-index/_search?pretty" \
  -u "elastic:${ELASTIC_PASSWORD}" \
  --cacert ./certs/ca/ca.crt
```

### Monitoring

View cluster metrics in Kibana:

- **Stack Monitoring**: <http://localhost:5601/app/monitoring>
- **Elastic health/metrics**: <http://localhost:5601/app/monitoring#/elasticsearch>

## üìö Additional Documentation

- [Elastic Stack Script Details](ELASTIC_STACK_SCRIPT.md) - Detailed script documentation
- [Fleet Setup Guide](FLEET_SETUP.md) - Fleet Server configuration details
- [Official Elastic Docs](https://www.elastic.co/guide/index.html) - Complete Elastic documentation
- [Official Elastic Docker Docs](https://www.elastic.co/docs/deploy-manage/deploy/self-managed/install-elasticsearch-with-docker) - Docker-specific deployment guidance

## ü§ù Contributing

Contributions are welcome! Please submit issues or pull requests via GitHub.

## üìù License

This deployment configuration follows the Elastic Stack licensing:

- **Basic License**: Free, includes core features
- **Trial License**: 30-day trial of Enterprise features

Change in `.env`:

```bash
LICENSE=basic  # or LICENSE=trial
```

Please refer to the [Elastic License](https://www.elastic.co/licensing/elastic-license) for more details.
